= General =
== Client &rarr; Server with reply ==
= Messages composition =
{| class="wikitable" style="text-align: center; font-size: 85%; width: auto; table-layout: fixed;"
|-
! Main code type
! Sub code type
! Packet size
! Data
|-
| style="background: #90ff90; color: black;" | 02
| style="background: #ffcc00; color: black;" | 0001
| {{Yes}}
| [[Base_protocol_messages#020001|Protocol initialization]]
|-
| style="background: #90ff90; color: black;" | 02
| style="background: #ffcc00; color: black;" | 0002
| {{Yes}}
| [[Base_protocol_messages#020002|Get first data and send the login]]
|-
| style="background: #90ff90; color: black;" | 02
| style="background: #ffcc00; color: black;" | 000C
| {{Yes}}
| [[Base_protocol_messages#02000C|Send datapack file list]]
|}

== Client &rarr; Server without reply ==
{| class="wikitable" style="text-align: center; font-size: 85%; width: auto; table-layout: fixed;"
|-
! Main code type
! Sub code type
! Packet size
! Data
|-
| style="background: #90ff90; color: black;" | 40
| 
| {{No}}
| [[Base_protocol_messages#40|Send position + direction]] '''''(Fast)'''''
|-
| style="background: #90ff90; color: black;" | 41
| 
| {{Yes}}
| [[Base_protocol_messages#41|Reply to server query]]
|-
| style="background: #90ff90; color: black;" | 42
| style="background: #ffcc00; color: black;" | 0003
| {{Yes}}
| [[Base_protocol_messages#420003|Chat]]
|-
| style="background: #90ff90; color: black;" | 42
| style="background: #ffcc00; color: black;" | 000A
| {{Yes}}
| [[Base_protocol_messages#42000A|Add players info to watch]]
|-
| style="background: #90ff90; color: black;" | 42
| style="background: #ffcc00; color: black;" | 000B
| {{Yes}}
| [[Base_protocol_messages#42000B|Remove players info to watch]]
|}

== Server &rarr; Client without reply ==
{| class="wikitable" style="text-align: center; font-size: 85%; width: auto; table-layout: fixed;"
|-
! Main code type
! Sub code type
! Packet size
! Data
|-
| style="background: #90ff90; color: black;" | C0
| 
| {{No}}
| [[Base_protocol_messages#C0|Position + direction of other player]] '''''(Fast)'''''
|-
| style="background: #90ff90; color: black;" | C1
| 
| {{Yes}}
| [[Base_protocol_messages#C1|Reply to client query]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0001
| {{Yes}}
| [[Base_protocol_messages#C20001|Random seed list]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0002
| {{Yes}}
| [[Base_protocol_messages#C20002|update of the player info]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0003
| {{Yes}}
| [[Base_protocol_messages#C2003|update file]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0005
| {{Yes}}
| [[Base_protocol_messages#C20005|chat]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0008
| {{Yes}}
| [[Base_protocol_messages#C20008|kicked/ban and reason]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 0009
| {{No}}
| [[Base_protocol_messages#C20009|Player number]]
|-
| style="background: #90ff90; color: black;" | C2
| style="background: #ffcc00; color: black;" | 000A
| {{No}}
| [[Base_protocol_messages#C2000A|Remove all other player on the map]]
|}

= Details =
== Client &rarr; Server with reply ==
=== 020001 ===
{{Note}}This first packet is send as raw + big (see [[General_protocol#Messages_composition|Messages composition]])

At the connection, send the protocol supported, <span style="font-weight: bold">before all!</span><br />query type: <span style="color: #8040FF">020001</span>, query number: <span style="color: #0000FF">01</span>, <span style="font-style: italic"><span style="color: #40BF00">&quot;catchchallenger-0.0.0.1&quot;</span></span>
 <span style="color: #8040FF">020001</span><span style="color: #0000FF">01</span><span style="color: #FFBF00">00000022</span><span style="color: #40BF00">0070006f006b006500630072006100660074002d0030002e0030002e0030002e0031</span>


Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">01</span>, <span style="color: #40BFFF">01</span> (is supported), compression used <span style="color: #40BF00">04</span> (gzip), size format <span style="color: #FF0000">01</span> (small: see [[General_protocol#Messages_composition|Messages composition]])
 <span style="color: #BF8000">C1</span><span style="color: #0000FF">01</span><span style="color: #40BFFF">01</span><span style="color: #40BF00">04</span><span style="color: #FF0000">01</span>
{{Note}}Compression used:
* <span style="color: #40BF00">00</span> raw
* <span style="color: #40BF00">01</span> lz4
* <span style="color: #40BF00">02</span> lz4hc
* <span style="color: #40BF00">03</span> zlib
* <span style="color: #40BF00">04</span> gzip

Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">01</span>,<span style="color: #40BFFF">02</span> (protocol not supported)
 <span style="color: #BF8000">C1</span><span style="color: #0000FF">01</span><span style="color: #40BFFF">02</span>
Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">01</span>,<span style="color: #40BFFF">03</span>, <span style="font-style: italic"><span style="color: #40BF00">&quot;Server full&quot;</span></span>
 <span style="color: #BF8000">C1</span><span style="color: #0000FF">01</span><span style="color: #40BFFF">03</span><span style="color: #FFBF00">0000002c</span><span style="color: #40BF00">00700072006f0074006f0063006f006c0020006e006f007400200073007500700070006f0072007400650064</span>

{{Note}}After this, all communication is into the packet size + compression mode send by the protocol.

=== 020002 ===
Get the first position and direction, and send login clear and pass sha1:<br />query type: <span style="color: #8040FF">020002</span>, query number: <span style="color: #0000FF">03</span>, <span style="color: #40BF00">&quot;toto&quot;</span>, <span style="color: #FF0040">da39a3ee5e6b4b0d3255bfef95601890afd80709</span><br />
 <span style="color: #8040FF">020002</span><span style="color: #0000FF">03</span><span style="color: #FFBF00">00000008</span><span style="color: #40BF00">0074006f0074006f</span><span style="color: #FF0040">da39a3ee5e6b4b0d3255bfef95601890afd80709</span>
Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">03</span>, <span style="color: #FF4000">01</span> (something is wrong), <span style="color: #40BF00">&quot;bad login&quot;</span> (or other server error)
 <span style="color: #BF8000">C1</span><span style="color: #0000FF">03</span><span style="color: #FF4000">01</span><span style="color: #FFBF00">00000012</span><span style="color: #40BF00">0062006100640020006c006f00670069006e</span>
Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">03</span>, <span style="color: #FF4000">02</span> (all is good), player id: <span style="color: #BFBF40">00002152</span> (see [[Base_protocol_messages#C20002|update of the player info]] to have the full info)
 <span style="color: #BF8000">C1</span><span style="color: #0000FF">03</span><span style="color: #FF4000">02</span><span style="color: #BFBF40">00002152</span>
After the server will send tp command to set the first position

=== 02000C ===
Send file name and md5 of the file requested:<br />query type: <span style="color: #8040FF">02000C</span>, query number: <span style="color: #0000FF">02</span>, number to file: <span style="color: #FF4000">00000003</span>, after is file and their mtime timestamps (second since 1/1/1970 in 64Bits):
* <span style="color: #40BF00">&quot;img/player/skin-01.png&quot;</span> <span style="color: #FF4000">4ED3C1D3</span>
* <span style="color: #40BF00">&quot;img/player/skin-01.png&quot;</span> <span style="color: #FF4000">4ED3C1D3</span>
* <span style="color: #40BF00">&quot;img/player/skin-01.png&quot;</span> <span style="color: #FF4000">4ED3C1D3</span>
 <span style="color: #8040FF">02000C</span><span style="color: #0000FF">02</span><span style="color: #FF4000">00000003</span>
 <span style="color: #FFBF00">0000002c</span><span style="color: #40BF00">0069006d0067002f0070006c0061007900650072002f0073006b0069006e002d00300031002e0070006e0067</span><span style="color: #FF4000">4ED3C1D3</span>
 <span style="color: #FFBF00">0000002c</span><span style="color: #40BF00">0069006d0067002f0070006c0061007900650072002f0073006b0069006e002d00300031002e0070006e0067</span><span style="color: #FF4000">4ED3C1D3</span>
 <span style="color: #FFBF00">0000002c</span><span style="color: #40BF00">0069006d0067002f0070006c0061007900650072002f0073006b0069006e002d00300031002e0070006e0067</span><span style="color: #FF4000">4ED3C1D3</span>
Server -&gt; Client: reply to the query from the client <span style="color: #BF8000">C1</span> with id <span style="color: #0000FF">02</span>, reply list (01 to found, 02 to delete):
* <span style="color: #FF4000">01</span>
* <span style="color: #FF4000">02</span>
* <span style="color: #FF4000">01</span>

== Client &rarr; Server without reply ==
=== 40 ===
Client -&gt; Server: query type: <span style="color: #8040FF">40</span>, previous moved unit: <span style="color: #0000FF">06</span>, direction: <span style="color: #FF4000">02</span>
 <span style="color: #8040FF">40</span><span style="color: #0000FF">06</span><span style="color: #FF4000">02</span>
direction def:
* <span style="color: #FF4000">01</span> = look at top
* <span style="color: #FF4000">02</span> = look at right
* <span style="color: #FF4000">03</span> = look at bottom
* <span style="color: #FF4000">04</span> = look at left
* <span style="color: #FF4000">05</span> = move at top
* <span style="color: #FF4000">06</span> = move at right
* <span style="color: #FF4000">07</span> = move at bottom
* <span style="color: #FF4000">08</span> = move at left
=== 41 ===
=== 420003 ===
Client -&gt; Server: query type: <span style="color: #8040FF">420003</span>, chat type: <span style="color: #FF4000">02</span>, text: <span style="color: #40BF00">&quot;hello&quot;</span>
 <span style="color: #8040FF">420003</span><span style="color: #FF4000">02</span><span style="color: #FFBF00">0000000a</span><span style="color: #40BF00">00680065006c006c006f</span>
Client -&gt; Server: query type: <span style="color: #8040FF">420003</span>, chat type: <span style="color: #FF4000">06</span>, text: <span style="color: #40BF00">&quot;hello&quot;</span>, player name: <span style="color: #40BF00">&quot;toto&quot;</span>
 <span style="color: #8040FF">420003</span><span style="color: #FF4000">06</span><span style="color: #FFBF00">0000000a</span><span style="color: #40BF00">00680065006c006c006f</span><span style="color: #FFBF00">00000008</span><span style="color: #40BF00">0074006f0074006f</span>
Chat type:
* <span style="color: #FF4000">02</span> = all (global)
* <span style="color: #FF4000">03</span> = clan
* <span style="color: #FF4000">06</span> = to player
=== 42000A ===
Add players info to watch:<br />query type: <span style="color: #8040FF">42000A</span>, type player query: <span style="color: #FF4000">02</span>, number to player to watch: <span style="color: #FFBF00">0001</span><br />
* <span style="color: #BFBF40">00002152</span>
 <span style="color: #8040FF">42000A</span><span style="color: #FF4000">02</span><span style="color: #FFBF00">0001</span><span style="color: #BFBF40">00002152</span>
type player query:
* <span style="color: #FF0040">01</span> permanent
* <span style="color: #FF0040">02</span> on demand
=== 42000B ===
Remove players info to watch: query type: <span style="color: #8040FF">42000B</span>, number to player to watch: <span style="color: #FFBF00">0001</span>
* <span style="color: #BFBF40">00002152</span>
 <span style="color: #8040FF">42000B</span><span style="color: #FFBF00">0001</span><span style="color: #BFBF40">00002152</span>

== Server &rarr; Client without reply ==

=== C0 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C0</span>, number of player near: <span style="color: #FF4000">0003</span>:<br /><ul><li>type other player def: <span style="color: #40BFFF">01</span>, player id: <span style="color: #BFBF40">00002152</span>, <span style="color: #40BF00">&quot;map name&quot;</span>, local x: <span style="color: #40BFFF">0002</span>, local y: <span style="color: #FFBF00">0002</span>, direction: <span style="color: #FF4000">02</span> (can be spawn walking when this wall go into screen), speed: <span style="color: #40BFFF">00C8</span> (200ms, see <a href="https://catchchallenger.first-world.info/viewtopic.php?f=2&amp;t=14" class="postlink">speed page</a>)</li><li>type other player def: <span style="color: #40BFFF">02</span>, player id: <span style="color: #BFBF40">00002153</span>, move with list size (<span style="color: #FFBF00">02</span>):<br /><ul><li>previous moved unit: <span style="color: #0000FF">06</span>, direction: <span style="color: #FF4000">02</span></li><li>previous moved unit: <span style="color: #0000FF">08</span>, direction: <span style="color: #FF4000">01</span></li></ul></li><li>type other player def: <span style="color: #40BFFF">03</span>, player id: <span style="color: #BFBF40">00002154</span></li></ul><blockquote class="uncited"><div><span style="color: #8040FF">C0</span><span style="color: #FF4000">0003</span><br /><span style="color: #40BFFF">01</span> <span style="color: #BFBF40">00002152</span><span style="color: #FFBF00">00000008</span><span style="color: #40BF00">0074006f0074006f</span><span style="color: #40BFFF">0002</span><span style="color: #FFBF00">0002</span><span style="color: #FF4000">02</span><span style="color: #40BFFF">00C8</span><br /><span style="color: #40BFFF">02</span> <span style="color: #BFBF40">00002153</span><span style="color: #FFBF00">02</span><span style="color: #0000FF">06</span><span style="color: #FF4000">02</span><span style="color: #0000FF">08</span><span style="color: #FF4000">01</span><br /><span style="color: #40BFFF">03</span> <span style="color: #BFBF40">00002154</span></div></blockquote><br /><br />direction def:<br /><ul><li><span style="color: #FF4000">01</span> = look at top</li><li><span style="color: #FF4000">02</span> = look at right</li><li><span style="color: #FF4000">03</span> = look at bottom</li><li><span style="color: #FF4000">04</span> = look at left</li><li><span style="color: #FF4000">05</span> = move at top</li><li><span style="color: #FF4000">06</span> = move at right</li><li><span style="color: #FF4000">07</span> = move at bottom</li><li><span style="color: #FF4000">08</span> = move at left</li></ul><br />type other player def:<br /><ul><li><span style="color: #40BFFF">01</span> = first position definition</li><li><span style="color: #40BFFF">02</span> = movement definition</li><li><span style="color: #40BFFF">03</span> = player is dropped</li></ul><br />For the case of try group the insert/move by set into type other player def other number, and say how many player will be set (drop multiple type other player def)<br /><ul><li>30 player with 2 move) Send as multiple single player: 10B*30=300B</li><li>30 player with 2 move) Send as group of player: 2B+9B*30=270B</li><li>250 player with 1 move) Send as multiple single player: 8B*250=2000B</li><li>250 player with 1 move) Send as group of player: 2B+7B*250=1752B</li></ul>Then ~10% of win. In case of 250 with one move, It's ~13% too. It do very big server overhead.
=== C1 ===

=== C20001 ===
Server -&gt; Client: <span style="color: #8040FF">C20001</span>, random bytes: <span style="color: #40BFFF">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX[...]XXXXXXXXXXX</span><br /><blockquote class="uncited"><div><span style="color: #8040FF">C20001</span><span style="color: #40BFFF">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX[...]XXXXXXXXXXX</span></div></blockquote>

=== C20002 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C20002</span>, number of player info to update: <span style="color: #FF4000">0002</span>:<br /><ul><li>Player 1:<br /><ul><li>player id: <span style="color: #BFBF40">00002152</span></li><li>pseudo: <span style="color: #40BF00">&quot;toto&quot;</span></li><li>description: <span style="color: #40BF00">&quot;master&quot;</span></li><li>clan: <span style="color: #FF4000">0001</span></li><li>status: <span style="color: #40BFFF">01</span></li><li>skin: <span style="color: #40BF00">&quot;skin name&quot;</span></li></ul></li><li>Current player:<br /><ul><li>player id: <span style="color: #BFBF40">00002153</span></li><li>pseudo: <span style="color: #40BF00">&quot;toto&quot;</span></li><li>description: <span style="color: #40BF00">&quot;master&quot;</span></li><li>clan: <span style="color: #FF4000">0001</span></li><li>status: <span style="color: #40BFFF">01</span></li><li>skin: <span style="color: #40BF00">&quot;skin name&quot;</span></li><li>And now private informations (here because it's the current player):<br /><ul><li>cash: <span style="color: #40BFFF">0000</span> (0$)</li></ul></li></ul></li></ul><blockquote class="uncited"><div><span style="color: #8040FF">C20002</span><span style="color: #FF4000">0002</span><br /><span style="color: #BFBF40">00002152</span><span style="color: #FFBF00">00000008</span><span style="color: #40BF00">0074006f0074006f</span><span style="color: #FFBF00">0000000c</span><span style="color: #40BF00">006d00610073007400650072</span><span style="color: #FF4000">0001</span><span style="color: #40BFFF">01</span><span style="color: #FFBF00">00000012</span><span style="color: #40BF00">0073006b0069006e0020006e0061006d0065</span><br /><span style="color: #BFBF40">00002153</span><span style="color: #FFBF00">00000008</span><span style="color: #40BF00">0074006f0074006f</span><span style="color: #FFBF00">0000000c</span><span style="color: #40BF00">006d00610073007400650072</span><span style="color: #FF4000">0001</span><span style="color: #40BFFF">01</span><span style="color: #FFBF00">00000012</span><span style="color: #40BF00">0073006b0069006e0020006e0061006d0065</span> <span style="color: #40BFFF">0000</span></div></blockquote><br /><br />direction def:<br /><ul><li><span style="color: #40BFFF">01</span> = normal player</li><li><span style="color: #40BFFF">02</span> = premium player</li><li><span style="color: #40BFFF">03</span> = gm</li><li><span style="color: #40BFFF">04</span> = dev</li></ul>

=== C20003 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C20003</span>, <span style="color: #40BF00">&quot;file name&quot;</span>, file size: <span style="color: #FF4000">00000050</span>, last modification time stamps: <span style="color: #FF4000">4ED3C1D3</span>, data: <span style="color: #40BFFF">XXXXXXXXXXXXXXXX[...]XXXXXXXXXX</span><br /><blockquote class="uncited"><div><span style="color: #8040FF">C20003</span><span style="color: #FFBF00">00000012</span><span style="color: #40BF00">0062006100640020006c006f00670069006e</span><span style="color: #FF4000">00000050</span><span style="color: #FF4000">4ED3C1D3</span><span style="color: #40BFFF">XXXXXXXXXXXXXXXX[...]XXXXXXXXXX</span></div></blockquote>

=== C20005 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C20005</span>, player id: <span style="color: #BFBF40">00002152</span>, chat type: <span style="color: #FF4000">02</span>, text: <span style="color: #40BF00">&quot;hello&quot;</span><br /><blockquote class="uncited"><div><span style="color: #8040FF">C20005</span><span style="color: #BFBF40">00002152</span><span style="color: #FF4000">01</span><span style="color: #FFBF00">0000000a</span><span style="color: #40BF00">00680065006c006c006f</span></div></blockquote><br /><br />Chat type:<br /><ul><li><span style="color: #FF4000">02</span> = all (global)</li><li><span style="color: #FF4000">03</span> = clan</li><li><span style="color: #FF4000">06</span> = to player</li><li><span style="color: #FF4000">07</span> = system</li><li><span style="color: #FF4000">08</span> = system importance: high</li></ul>

=== C20008 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C20008</span>, type: <span style="color: #FF4000">02</span>, <span style="color: #40BF00">&quot;toto&quot;</span><br /><blockquote class="uncited"><div><span style="color: #8040FF">C20008</span><span style="color: #FF4000">02</span><span style="color: #FFBF00">00000010</span><span style="color: #40BF00">006d006100700020006e0061006d0065</span></div></blockquote><br /><br />orientation def:<br /><ul><li><span style="color: #FF4000">01</span> = kicked</li><li><span style="color: #FF4000">02</span> = ban</li><li><span style="color: #FF4000">03</span> = disconnected</li></ul>

=== C20009 ===
Server -&gt; Client: query type: <span style="color: #8040FF">C20009</span>, current: <span style="color: #FF4000">0002</span>, max: <span style="color: #40BF00">0064</span> (then 100 in decimal)<br /><blockquote class="uncited"><div><span style="color: #8040FF">C20009</span><span style="color: #FF4000">0002</span><span style="color: #40BF00">0064</span></div></blockquote>

=== C2000A ===
Remove all other player on the map: (Better than remove each id)<br />query type: <span style="color: #8040FF">C2000A</span>
